# CDN的作用与基本过程

2016年10月13日 17:56:32

 **摘自**https://blog.csdn.net/lihao21/article/details/52808747

# 简介

CDN，Content Distribute Network，可以直译成内容分发网络，CDN解决的是如何将数据快速可靠从源站传递到用户的问题。用户获取数据时，不需要直接从源站获取，通过CDN对于数据的分发，用户可以从一个较优的服务器获取数据，从而达到快速访问，并减少源站负载压力的目的。

# 动机

﻿为什么不进行数据的直接交付，即让用户直接从源站获取数据呢？ 
我们常说的互联网实际上由两层组成，一层是以TCP/IP为核心的网络层即Internet（因特网），另一层则是以万维网WWW为代表的应用层。数据从服务器端交付到用户端，至少有4个地方可能会造成网络拥堵。 
\1. “第一公里”，这是指万维网流量向用户传送的第一个出口，是网站服务器接入互联网的链路。这个出口带宽决定了一个网站能为用户提供的访问速度和并发访问量。当用户请求量超出网站的出口带宽，就会在出口处造成拥塞。 
\2. “最后一公里”，万维网流量向用户传送的最后一段链路，即用户接入互联网的链路。用户接入的带宽影响用户接收流量的能力。随着电信运营商的大力发展，用户的接入带宽得到了很大改善，“最后一公里”问题基本得到解决。 
\3. ISP互联，即因特网服务提供商之间的互联，比如中国电信和中国联通两个网络运营商之间的互联互通。当某个网站服务器部署在运营商A的机房，运营商B的用户要访问该网站，那就必须经过A、B之间的互联互通点进行跨网访问。从互联网的架构来看，不同运营商之间的互联互通带宽，对任何一个运营商网络流量来说，占比都非常小。因此，这里也通常是网络传输的拥堵点。 
\4. 长途骨干传输。首先是长距离传输时延问题，其次是骨干网络的拥塞问题，这些问题都会造成万维网流量传输的拥堵。 
从以上对于网络拥堵的情况分析，如果网络上的数据都使用从源站直接交付到用户的方法，那么将极有可能会出现访问拥塞的情况。 
如果能有一种技术方案，将数据缓存在离用户最近的地方，使用户以最快的速度获取，那这对于减少网站的出口带宽压力，减少网络传输的拥堵情况，将起到很大的作用。CDN正是这样一种技术方案。

# 基本过程

用户通过浏览器访问传统的（没有使用CDN）网站的过程如下。 

https://img-blog.csdn.net/20161013175325148

\1. 用户在浏览器中输入要访问的域名。 
\2. 浏览器向DNS服务器请求对该域名的解析。 
\3. DNS服务器返回该域名的IP地址给浏览器。 
\4. 浏览器使用该IP地址向服务器请求内容。 
\5. 服务器将用户请求的内容返回给浏览器。

如果使用了CDN，则其过程会变成以下这样。 

https://img-blog.csdn.net/20161013175340580

\1. 用户在浏览器中输入要访问的域名。 
\2. 浏览器向DNS服务器请求对域名进行解析。由于CDN对域名解析进行了调整，DNS服务器会最终将域名的解析权交给CNAME指向的CDN专用DNS服务器。 
\3. CDN的DNS服务器将CDN的负载均衡设备IP地址返回给用户。 
\4. 用户向CDN的负载均衡设备发起内容URL访问请求。 
\5. CDN负载均衡设备会为用户选择一台合适的缓存服务器提供服务。 
选择的依据包括：根据用户IP地址，判断哪一台服务器距离用户最近；根据用户所请求的URL中携带的内容名称，判断哪一台服务器上有用户所需内容；查询各个服务器的负载情况，判断哪一台服务器的负载较小。 
基于以上这些依据的综合分析之后，负载均衡设置会把缓存服务器的IP地址返回给用户。 
\6. 用户向缓存服务器发出请求。 
\7. 缓存服务器响应用户请求，将用户所需内容传送到用户。 
如果这台缓存服务器上并没有用户想要的内容，而负载均衡设备依然将它分配给了用户，那么这台服务器就要向它的上一级缓存服务器请求内容，直至追溯到网站的源服务器将内容拉取到本地。

# 总结

在网站和用户之间引入CDN之后，用户不会有任何与原来不同的感觉。 
使用CDN服务的网站，只需将其域名的解析权交给CDN的负载均衡设备，CDN负载均衡设备将为用户选择一台合适的缓存服务器，用户通过访问这台缓存服务器来获取自己所需的数据。 
由于缓存服务器部署在网络运营商的机房，而这些运营商又是用户的网络服务提供商，因此用户可以以最短的路径，最快的速度对网站进行访问。因此，CDN可以加速用户访问速度，减少源站中心负载压力。