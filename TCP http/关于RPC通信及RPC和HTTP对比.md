# 1.关于RPC

**看了很多文章，没有一篇感觉讲解的很好，这是我摘自百度百科的，相对好理解一些，少了一个http层的拆包，装包，看报文的一个过程，我这么理解的，RPC反而更快了，以下内容看了会明白一些.**


 [同义词](https://baike.baidu.com/subview/71844/10028254.htm) RPC一般指远程过程调用协议 



RPC（Remote Procedure Call）—[远程过程调用](https://baike.baidu.com/item/%E8%BF%9C%E7%A8%8B%E8%BF%87%E7%A8%8B%E8%B0%83%E7%94%A8)，它是一种通过[网络](https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C)从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。[RPC协议](https://baike.baidu.com/item/RPC%E5%8D%8F%E8%AE%AE)假定某些[传输协议](https://baike.baidu.com/item/%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE)的存在，如TCP或UDP，为通信程序之间携带信息数据。在OSI[网络通信](https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1)模型中，RPC跨越了[传输层](https://baike.baidu.com/item/%E4%BC%A0%E8%BE%93%E5%B1%82)和[应用层](https://baike.baidu.com/item/%E5%BA%94%E7%94%A8%E5%B1%82)。RPC使得开发包括网络[分布式](https://baike.baidu.com/item/%E5%88%86%E5%B8%83%E5%BC%8F)多程序在内的应用程序更加容易。

RPC采用客户机/服务器模式。请求程序就是一个客户机，而服务提供程序就是一个服务器。首先，客户机调用进程发送一个有进程参数的调用信息到服务进程，然后等待应答信息。在服务器端，进程保持睡眠状态直到调用信息到达为止。当一个调用信息到达，服务器获得进程参数，计算结果，发送答复[信息](https://baike.baidu.com/item/%E4%BF%A1%E6%81%AF)，然后等待下一个调用信息，最后，客户端调用进程接收答复信息，获得进程结果，然后调用执行继续进行。

有多种 RPC模式和执行。最初由 Sun 公司提出。IETF ONC 宪章重新修订了 Sun 版本，使得 ONC RPC 协议成为 IETF 标准协议。现在使用最普遍的模式和执行是开放式软件基础的分布式计算[环境](https://baike.baidu.com/item/%E7%8E%AF%E5%A2%83)（DCE）。

 

 

- 中文名

   远程过程调用 

- 外文名

   Remote Procedure Call 

- 核心思想

   信息传输协议 

- 研究方向

   分布式 

 

## 目录

1.  1 [工作原理](https://baike.baidu.com/item/%E8%BF%9C%E7%A8%8B%E8%BF%87%E7%A8%8B%E8%B0%83%E7%94%A8%E5%8D%8F%E8%AE%AE/6893245?fromtitle=RPC&fromid=609861#1) 
2.  2 [协议结构](https://baike.baidu.com/item/%E8%BF%9C%E7%A8%8B%E8%BF%87%E7%A8%8B%E8%B0%83%E7%94%A8%E5%8D%8F%E8%AE%AE/6893245?fromtitle=RPC&fromid=609861#2) 

 

​    

## 工作原理

编辑

 

运行时,一次客户机对服务器的RPC调用,其内部操作大致有如下十步：

 

1.调用客户端句柄；执行传送参数

 

2.调用本地系统[内核](https://baike.baidu.com/item/%E5%86%85%E6%A0%B8)发送网络消息

 

3.[消息传送](https://baike.baidu.com/item/%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%81)到远程[主机](https://baike.baidu.com/item/%E4%B8%BB%E6%9C%BA)

 

4.服务器句柄得到消息并取得参数

 

 [ ![img](https://gss3.bdstatic.com/7Po3dSag_xI4khGkpoWK1HF6hhy/baike/s%3D220/sign=7e27f7747aec54e745ec1d1c89399bfd/18d8bc3eb13533fadd93e964a9d3fd1f41345b56.jpg) ](https://baike.baidu.com/pic/%E8%BF%9C%E7%A8%8B%E8%BF%87%E7%A8%8B%E8%B0%83%E7%94%A8%E5%8D%8F%E8%AE%AE/6893245/0/18d8bc3eb13533fadd93e964a9d3fd1f41345b56?fr=lemma&ct=single) 

 

6.执行的过程将结果返回服务器句柄

 

7.服务器句柄返回结果，调用远程系统[内核](https://baike.baidu.com/item/%E5%86%85%E6%A0%B8)

 

8.消息传回[本地主机](https://baike.baidu.com/item/%E6%9C%AC%E5%9C%B0%E4%B8%BB%E6%9C%BA)

 

9.客户句柄由内核接收消息

 

10.客户接收句柄返回的数据

 

**RPC OVER HTTP**

 

Microsoft RPC-over-HTTP 部署(RPC over HTTP)允许RPC客户端安全和有效地通过Internet 连接到RPC 服务器程序并执行[远程过程调用](https://baike.baidu.com/item/%E8%BF%9C%E7%A8%8B%E8%BF%87%E7%A8%8B%E8%B0%83%E7%94%A8)。这是在一个名称为RPC-over-HTTP 代理，或简称为RPC 代理的[中间件](https://baike.baidu.com/item/%E4%B8%AD%E9%97%B4%E4%BB%B6)的帮助下完成的。

 

RPC 代理运行在IIS计算机上。它接受来自Internet 的RPC 请求，在这些请求上执行认证，检验和访问检查，如果请求通过所有的测试，RPC 代理将请求转发给执行真正处理的RPC [服务器](https://baike.baidu.com/item/%E6%9C%8D%E5%8A%A1%E5%99%A8)。通过RPC over HTTP，RPC客户端不和服务器直接通信，它们使用RPC 代理作为中间件。



# 2.RPC服务和HTTP服务对比

很长时间以来都没有怎么好好搞清楚RPC（即Remote Procedure Call，远程过程调用）和HTTP调用的区别，不都是写一个服务然后在客户端调用么？这里请允许我迷之一笑~Naive！本文简单地介绍一下两种形式的C/S架构，先说一下他们最本质的区别，就是RPC主要是基于TCP/IP协议的，而HTTP服务主要是基于HTTP协议的，我们都知道HTTP协议是在传输层协议TCP之上的，所以效率来看的话，RPC当然是要更胜一筹啦！下面来具体说一说RPC服务和HTTP服务。

 

##  OSI网络七层模型

 

 在说RPC和HTTP的区别之前，我觉的有必要了解一下OSI的七层网络结构模型（虽然实际应用中基本上都是五层），它可以分为以下几层： （从上到下）

 

-  第一层：应用层。定义了用于在网络中进行通信和传输数据的接口；
-  第二层：表示层。定义不同的系统中数据的传输格式，编码和解码规范等；
-  第三层：会话层。管理用户的会话，控制用户间逻辑连接的建立和中断；
-  第四层：传输层。管理着网络中的端到端的数据传输；
-  第五层：网络层。定义网络设备间如何传输数据；
-  第六层：链路层。将上面的网络层的数据包封装成数据帧，便于物理层传输；
-  第七层：物理层。这一层主要就是传输这些二进制数据。

 实际应用过程中，五层协议结构里面是没有表示层和会话层的。应该说它们和应用层合并了。我们应该将重点放在应用层和传输层这两个层面。因为HTTP是应用层协议，而TCP是传输层协议。好，知道了网络的分层模型以后我们可以更好地理解为什么RPC服务相比HTTP服务要Nice一些！

 

##  RPC服务

 

 从三个角度来介绍RPC服务：分别是RPC架构，同步异步调用以及流行的RPC框架。

 

###  RPC架构

 

 先说说RPC服务的基本架构吧。允许我可耻地盗一幅图哈~我们可以很清楚地看到，一个完整的RPC架构里面包含了四个核心的组件，分别是Client ,Server,Client  Stub以及Server Stub，这个Stub大家可以理解为存根。分别说说这几个组件：

 

-  客户端（Client），服务的调用方。
-  服务端（Server），真正的服务提供者。
-  客户端存根，存放服务端的地址消息，再将客户端的请求参数打包成网络消息，然后通过网络远程发送给服务方。
-  服务端存根，接收客户端发送过来的消息，将消息解包，并调用本地的方法。

 [![img](https://obrxbqjbi.qnssl.com/blog/image/rpc-architecture.jpg)](https://obrxbqjbi.qnssl.com/blog/image/rpc-architecture.jpg)

 

 RPC主要是用在大型企业里面，因为大型企业里面系统繁多，业务线复杂，而且效率优势非常重要的一块，这个时候RPC的优势就比较明显了。实际的开发当中是这么做的，项目一般使用maven来管理。比如我们有一个处理订单的系统服务，先声明它的所有的接口（这里就是具体指Java中的`interface`），然后将整个项目打包为一个`jar`包，服务端这边引入这个二方库，然后实现相应的功能，客户端这边也只需要引入这个二方库即可调用了。为什么这么做？主要是为了减少客户端这边的`jar`包大小，因为每一次打包发布的时候，`jar`包太多总是会影响效率。另外也是将客户端和服务端解耦，提高代码的可移植性。

 

###  同步调用与异步调用

 

 什么是同步调用？什么是异步调用？`同步调用`就是客户端等待调用执行完成并返回结果。`异步调用`就是客户端不等待调用执行完成返回结果，不过依然可以通过回调函数等接收到返回结果的通知。如果客户端并不关心结果，则可以变成一个单向的调用。这个过程有点类似于Java中的`callable`和`runnable`接口，我们进行异步执行的时候，如果需要知道执行的结果，就可以使用`callable`接口，并且可以通过`Future`类获取到异步执行的结果信息。如果不关心执行的结果，直接使用`runnable`接口就可以了，因为它不返回结果，当然啦，`callable`也是可以的，我们不去获取`Future`就可以了。

 

###  流行的RPC框架

 

 目前流行的开源RPC框架还是比较多的。下面重点介绍三种：

 

1.  gRPC是Google最近公布的开源软件，基于最新的HTTP2.0协议，并支持常见的众多编程语言。 我们知道HTTP2.0是基于二进制的HTTP协议升级版本，目前各大浏览器都在快马加鞭的加以支持。 这个RPC框架是基于HTTP协议实现的，底层使用到了Netty框架的支持。
2.  Thrift是Facebook的一个开源项目，主要是一个跨语言的服务开发框架。它有一个代码生成器来对它所定义的IDL定义文件自动生成服务代码框架。用户只要在其之前进行二次开发就行，对于底层的RPC通讯等都是透明的。不过这个对于用户来说的话需要学习特定领域语言这个特性，还是有一定成本的。
3.  Dubbo是阿里集团开源的一个极为出名的RPC框架，在很多互联网公司和企业应用中广泛使用。协议和序列化框架都可以插拔是及其鲜明的特色。同样 的远程接口是基于Java Interface，并且依托于spring框架方便开发。可以方便的打包成单一文件，独立进程运行，和现在的微服务概念一致。

 `偷偷告诉你`集团内部已经不怎么使用dubbo啦，现在用的比较多的叫HSF，又名“好舒服”。后面有可能会开源，大家拭目以待。

 

##  HTTP服务

 

 其实在很久以前，我对于企业开发的模式一直定性为HTTP接口开发，也就是我们常说的RESTful风格的服务接口。的确，对于在接口不多、系统与系统交互较少的情况下，解决信息孤岛初期常使用的一种通信手段；优点就是简单、直接、开发方便。利用现成的http协议进行传输。我们记得之前本科实习在公司做后台开发的时候，主要就是进行接口的开发，还要写一大份接口文档，严格地标明输入输出是什么？说清楚每一个接口的请求方法，以及请求参数需要注意的事项等。比如下面这个例子：
`POST  http://www.httpexample.com/restful/buyer/info/share`
 接口可能返回一个JSON字符串或者是XML文档。然后客户端再去处理这个返回的信息，从而可以比较快速地进行开发。但是对于大型企业来说，内部子系统较多、接口非常多的情况下，RPC框架的好处就显示出来了，首先就是长链接，不必每次通信都要像http一样去3次握手什么的，减少了网络开销；其次就是RPC框架一般都有注册中心，有丰富的监控管理；发布、下线接口、动态扩展等，对调用方来说是无感知、统一化的操作。

 

##  总结

 

 RPC服务和HTTP服务还是存在很多的不同点的，一般来说，RPC服务主要是针对大型企业的，而HTTP服务主要是针对小企业的，因为RPC效率更高，而HTTP服务开发迭代会更快。总之，选用什么样的框架不是按照市场上流行什么而决定的，而是要对整个项目进行完整地评估，从而在仔细比较两种开发框架对于整个项目的影响，最后再决定什么才是最适合这个项目的。一定不要为了使用RPC而每个项目都用RPC，而是要因地制宜，具体情况具体分析。